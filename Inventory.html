<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System</title>
</head>
<body>

    <h2 style="text-align: center;">Inventory Management System</h2>

    <input type="number" id="itemId" placeholder="Item ID">
    <input type="text" id="itemName" placeholder="Item Name">
    <input type="number" id="price" placeholder="Price">
    <input type="number" id="stocksLeft" placeholder="Stocks Left">

    <button id="saveButton">Save</button>
    <button id="updateButton">Update</button>

    <p id="status" class="status"></p>

    <h3>Saved Items:</h3>
    <!-- Add this table structure to your HTML -->
    <table id="recommendationsTable">
        <thead>
            
        </thead>
        <tbody>
            <!-- Table body will be dynamically filled using JavaScript -->
        </tbody>
    </table>


    <!-- SCRIPT START -->
    <script>
        document.addEventListener("DOMContentLoaded", function ()
        {
            // Check if browser supports localStorage
            if (typeof(Storage) !== "undefined")
            {
                // Load data from localStorage when the page loads
                loadDataFromLocalStorage();

                // Save data to localStorage when the user clicks the "Save" button
                document.getElementById("saveButton").addEventListener("click", function ()
                {
                    saveDataToLocalStorage(true);
                });

                // Update button
                document.getElementById("updateButton").addEventListener("click", function ()
                {
                    saveDataToLocalStorage(false);
                });

                // Clear data from localStorage when the user clicks the "Clear" button
                // document.getElementById("clearButton").addEventListener("click", function ()
                // {
                //     clearDataFromLocalStorage();
                // });

                // Check internet connectivity and sync data if available
                checkInternetConnectivity();
            }
            else
            {
                alert("Sorry, your browser does not support localStorage. The application may not work properly.");
            }
        });

        function findItemIndexById(items, itemId)
        {
            // Helper function to find the index of an item by name
            for (var i = 0; i < items.length; i++)
            {
                if (items[i].itemId === itemId)
                {
                    return i;
                }
            }
            return -1; // Item not found
        }

        function findItemIndexByName(items, itemName)
        {
            // Helper function to find the index of an item by name
            for (var i = 0; i < items.length; i++)
            {
                if (items[i].itemName === itemName)
                {
                    return i;
                }
            }
            return -1; // Item not found
        }


        function saveDataToLocalStorage(isSave)
        {
            var itemId;
            // Save data to localStorage
            var savedItems = JSON.parse(localStorage.getItem("savedItems")) || [];

            if(isSave)
            {
                itemId = savedItems.length + 1;
            }
            else
            {
                itemId = document.getElementById("itemId").value;
            }
            var itemName = document.getElementById("itemName").value;
            var price = document.getElementById("price").value;
            var stocksLeft = document.getElementById("stocksLeft").value;
            var status = document.getElementById("status");

            // Check if item already exists or not
            var existingItemIndex = findItemIndexByName(savedItems, itemName);
            var existingItemIndexById = findItemIndexById(savedItems, itemId);
            if (existingItemIndex !== -1 || existingItemIndexById !== -1)
            {
                // Item already exists, update its details
                savedItems[existingItemIndex].price = price;
                savedItems[existingItemIndex].stocksLeft = stocksLeft;
                status.innerText = "Item updated successfully!";
            }
            else
            {
                // Item does not exist, add a new item
                savedItems.push({ itemName: itemName, price: price, stocksLeft: stocksLeft });
                status.innerText = "Item added successfully!";
            }

            // Reset the textboxes
            document.getElementById("itemName").value = '';
            document.getElementById("price").value = '';
            document.getElementById("stocksLeft").value = '';

            //alert("Data saved successfully!");

            // Sync data if internet connectivity is available
            checkInternetConnectivity();
            // loadDataFromLocalStorage();
        }

        function loadDataFromLocalStorage()
        {
            // Load data from localStorage
            var savedItems = JSON.parse(localStorage.getItem("savedItems")) || [];

            // Display the loaded data on the page
            for (var i = 0; i < savedItems.length; i++)
            {
                displayItem(savedItems[i]);
            }
        }

        function clearDataFromLocalStorage()
        {
            // Clear data from localStorage
            localStorage.removeItem("savedItems");

            // Clear the input fields on the page
            document.getElementById("itemName").value = "";
            document.getElementById("price").value = "";
            document.getElementById("stocksLeft").value = "";

            alert("Data cleared successfully!");
        }

        function checkInternetConnectivity()
        {
            // Check internet connectivity (placeholder - replace with actual logic)
            var isOnline = navigator.onLine;

            if (isOnline)
            {
                // If online, sync data with the API (placeholder - replace with actual API endpoint)
                var savedItems = JSON.parse(localStorage.getItem("savedItems")) || [];
                syncDataWithAPI(savedItems);
            }
        }

        function syncDataWithAPI(data)
        {
            // Placeholder for API sync logic
            // Replace the following line with actual API endpoint and HTTP request
            console.log("Syncing data with API:", data);
            // For simplicity, we are just logging the data to the console here.
        }
        function displayItem(item)
        {
            // Load existing items from localStorage
            var savedItems = JSON.parse(localStorage.getItem("savedItems")) || [];

            // Add the new item to the array
            //savedItems.push(item);

            // Sort the items alphabetically by itemName
            savedItems.sort(function(a, b)
            {
                var itemNameA = a.itemName.toUpperCase();
                var itemNameB = b.itemName.toUpperCase();
                if (itemNameA < itemNameB)
                {
                    return -1;
                }
                if (itemNameA > itemNameB)
                {
                    return 1;
                }
                return 0;
            });

            // Clear the recommendations table
            clearRecommendationsTable();

            // Display the sorted items in a table
            var recommendationsTable = document.getElementById("recommendationsTable");

            // Insert rows into the thead
            var theadRow = recommendationsTable.insertRow(0);
            var headers = ["#", "Item Name", "Price", "Stock"];
            for (var i = 0; i < headers.length; i++)
            {
                var th = document.createElement("th");
                th.textContent = headers[i];
                theadRow.appendChild(th);
            }

            // Insert rows into the tbody
            var tbody = recommendationsTable.createTBody();
            for (var i = 0; i < savedItems.length; i++)
            {
                displaySingleItemInTable(savedItems[i], tbody);
            }
        }

        function clearRecommendationsTable()
        {
            // Clear the recommendations table
            var recommendationsTable = document.getElementById("recommendationsTable");
            recommendationsTable.innerHTML = "";
        }

        function displaySingleItemInTable(item, table)
        {
            // Display a single item in the table
            var row = table.insertRow(-1);

            var cell1 = row.insertCell(0);
            cell1.innerHTML = item.itemId;

            var cell2 = row.insertCell(1);
            cell2.innerHTML = item.itemName;

            var cell3 = row.insertCell(2);
            cell3.innerHTML = item.price;

            var cell4 = row.insertCell(3);
            cell4.innerHTML = item.stocksLeft;
        }

    </script>
    <!-- SCRIPT END -->

    <!-- STYLE START -->
    <style>

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            margin: 20px;
        }

        h2 {
            color: #333;
        }

        label {
            display: block;
            margin-top: 10px;
            color: #555;
        }

        input {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            box-sizing: border-box;
        }

        button {
            background-color: #4caf50;
            color: white;
            padding: 10px 20px;
            margin-top: 10px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        button:hover {
            background-color: #45a049;
        }

        textarea {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            box-sizing: border-box;
        }

        textarea:disabled {
            background-color: #eee;
        }

        h3 {
            margin-top: 20px;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #4caf50;
            color: white;
        }


    </style>
    
    <!-- STYLE END -->

</body>
</html>
